# Learn4Go ä»£ç å®¡æŸ¥ä¿®å¤æŠ¥å‘Š

**æ—¥æœŸ**: 2025-12-05  
**é¡¹ç›®**: Learn4Go  
**å®¡æŸ¥èŒƒå›´**: åç«¯ä»£ç ã€å‰ç«¯ä»£ç ã€é¡¹ç›®æ–‡æ¡£

---

## ğŸ“Š æ€»ä½“æ¦‚è§ˆ

| ä¼˜å…ˆçº§ | é—®é¢˜æ•° | å·²ä¿®å¤ | çŠ¶æ€ |
|--------|--------|--------|------|
| **P0 (ä¸¥é‡)** | 5 | 5 | âœ… å…¨éƒ¨å®Œæˆ |
| **P1 (é«˜)** | 7 | 7 | âœ… å…¨éƒ¨å®Œæˆ |
| **P2 (ä¸­)** | 15 | 0 | â³ å¾…å¤„ç† |
| **P3 (ä½)** | 11 | 0 | â³ å¾…å¤„ç† |

**æ„å»ºçŠ¶æ€**: âœ… é€šè¿‡  
**ä»£ç å®¡æŸ¥**: âœ… å·²éªŒè¯

---

# ç¬¬ä¸€éƒ¨åˆ†ï¼šP0 ä¸¥é‡é—®é¢˜ä¿®å¤

## P0 ä¿®å¤æ¦‚è§ˆ

| é—®é¢˜ | ç±»åˆ« | ä¿®æ”¹æ–‡ä»¶ | çŠ¶æ€ |
|------|------|----------|------|
| P0-1 | å®‰å…¨ | `cmd/todoapi/main.go`, `internal/todo/handler.go` | âœ… |
| P0-2 | å¯é æ€§ | `internal/todo/store.go` | âœ… |
| P0-3 | å…¼å®¹æ€§ | `cmd/todoapi/main.go` | âœ… |
| P0-4 | å“ç‰Œ | `web/login.html`, `web/admin.html` | âœ… |
| P0-5 | å®‰å…¨ | `web/js/mock-api.js` | âœ… |

---

## P0-1: JWT å¯†é’¥ç¯å¢ƒå˜é‡åŒ–

**é—®é¢˜**: JWT å¯†é’¥ç¡¬ç¼–ç åœ¨ `handler.go:62`  
**é£é™©**: å¯†é’¥æš´éœ²åœ¨æºä»£ç æ§åˆ¶ä¸­

**è§£å†³æ–¹æ¡ˆ**:
- JWT å¯†é’¥æ”¹ä¸ºä» `JWT_SECRET` ç¯å¢ƒå˜é‡è¯»å–
- éå†…å­˜å­˜å‚¨æ¨¡å¼å¿…é¡»è®¾ç½®ç¯å¢ƒå˜é‡
- å†…å­˜æ¨¡å¼ä½¿ç”¨é»˜è®¤å€¼å¹¶æ‰“å°è­¦å‘Š

**ä»£ç å˜æ›´** (`cmd/todoapi/main.go`):
```go
jwtSecret := getEnv("JWT_SECRET", "")
if storage != "memory" && jwtSecret == "" {
    log.Fatal("JWT_SECRET environment variable is required for non-memory storage")
}
if jwtSecret == "" {
    jwtSecret = "dev-secret-key"
    log.Println("âš ï¸  Using default JWT secret for development")
}
s := todo.NewServer(store, todo.WithJWT(jwtSecret, 24*time.Hour))
```

---

## P0-2: éšæœº ID å†²çªä¿®å¤

**é—®é¢˜**: `rand.Intn(1_000_000)` å¯èƒ½ç”Ÿæˆé‡å¤ ID  
**é£é™©**: æ–°å»ºçš„ TODO å¯èƒ½è¦†ç›–å·²æœ‰æ•°æ®

**è§£å†³æ–¹æ¡ˆ**: æ·»åŠ å­˜åœ¨æ€§æ£€æŸ¥å¾ªç¯

**ä»£ç å˜æ›´** (`internal/todo/store.go`):
```go
func (s *Store) Create(title string, userID uint) (Todo, error) {
    s.mu.Lock()
    defer s.mu.Unlock()
    
    var id int
    for {
        id = rand.Intn(1_000_000)
        if _, exists := s.items[id]; !exists {
            break
        }
    }
    // ...
}
```

---

## P0-3: åˆ é™¤åºŸå¼ƒçš„ rand.Seed()

**é—®é¢˜**: `rand.Seed(time.Now().UnixNano())` åœ¨ Go 1.20+ å·²åºŸå¼ƒ  
**é£é™©**: ç¼–è¯‘å™¨è­¦å‘Šï¼Œæœªæ¥å…¼å®¹æ€§é—®é¢˜

**è§£å†³æ–¹æ¡ˆ**: åˆ é™¤è¯¥è°ƒç”¨ï¼ˆGo 1.20+ è‡ªåŠ¨åˆå§‹åŒ–ï¼‰

---

## P0-4: å‰ç«¯å“ç‰Œåç§°ä¿®æ­£

**é—®é¢˜**: é¡µé¢æ˜¾ç¤º "Python Learning Platform" è€Œé "Learn4Go"

**è§£å†³æ–¹æ¡ˆ**: æ›´æ–°æ ‡é¢˜å’Œæè¿°æ–‡æœ¬

**å˜æ›´ä½ç½®**:
- `web/login.html:6` - æ ‡é¢˜æ”¹ä¸º "ç™»å½• - Learn4Go"
- `web/admin.html:6` - æ ‡é¢˜æ”¹ä¸º "ç®¡ç†åå° - Learn4Go"

---

## P0-5: mock-api.js XSS é˜²æŠ¤

**é—®é¢˜**: ä½¿ç”¨ `innerHTML` æ˜¾ç¤ºå¯èƒ½åŒ…å«æ¶æ„ HTML çš„å†…å®¹  
**é£é™©**: XSS æ”»å‡»

**è§£å†³æ–¹æ¡ˆ**: æ”¹ç”¨ `textContent`

**ä»£ç å˜æ›´** (`web/js/mock-api.js`):
```javascript
// ä¿®æ”¹å‰
statsDiv.querySelector('[data-stat="total"]').innerHTML = data.total;

// ä¿®æ”¹å
statsDiv.querySelector('[data-stat="total"]').textContent = data.total;
```

---

# ç¬¬äºŒéƒ¨åˆ†ï¼šP1 é«˜ä¼˜å…ˆçº§é—®é¢˜ä¿®å¤

## P1 ä¿®å¤æ¦‚è§ˆ

| é—®é¢˜ | ç±»åˆ« | ä¿®æ”¹æ–‡ä»¶ | çŠ¶æ€ |
|------|------|----------|------|
| P1-H1 | å†…å­˜ | `handler.go` | âœ… |
| P1-H2 | å†…å­˜ | `handler.go` | âœ… |
| P1-H3 | å®‰å…¨ | `security.go`, `handler.go` | âœ… |
| P1-H4 | å®‰å…¨ | `security.go`, `handler.go` | âœ… |
| P1-H5 | èµ„æº | `ratelimit.go` | âœ… |
| P1-F-H1 | å¯ç»´æŠ¤æ€§ | `web/css/variables.css`, `web/admin.html` | âœ… |
| P1-F-H3 | å¯é æ€§ | `web/portal.html` | âœ… |

---

## P1-H1 & P1-H2: å†…å­˜æ¸…ç†æœºåˆ¶

**é—®é¢˜**: 
- `refreshStore` map æ— é™å¢é•¿ï¼ˆè¿‡æœŸ token ä»…åœ¨è®¿é—®æ—¶åˆ é™¤ï¼‰
- `loginFailures` map ä»ä¸æ¸…ç†æ—§è®°å½•

**è§£å†³æ–¹æ¡ˆ**: æ·»åŠ ç»Ÿä¸€çš„åå°æ¸…ç†æœºåˆ¶

**ä»£ç å˜æ›´** (`internal/todo/handler.go`):
```go
// æ–°å¢ Server å­—æ®µ
cleanupDone chan struct{}

// æ–°å¢æ–¹æ³•
func (s *Server) Shutdown()
func (s *Server) startCleanup()
func (s *Server) cleanExpiredRefreshTokens()
func (s *Server) cleanExpiredLoginFailures()
```

---

## P1-H3: å¯†ç å¼ºåº¦éªŒè¯

**é—®é¢˜**: æ— å¯†ç å¼ºåº¦è¦æ±‚ï¼Œç”¨æˆ·å¯ç”¨ "123" æ³¨å†Œ

**è§£å†³æ–¹æ¡ˆ**: æ·»åŠ  `ValidatePassword()` å‡½æ•°

**ä»£ç å˜æ›´** (`internal/todo/security.go`):
```go
func ValidatePassword(password string) error {
    if len(password) < 8 {
        return ErrWeakPassword
    }
    // æ£€æŸ¥å¿…é¡»åŒ…å«å­—æ¯å’Œæ•°å­—
}
```

---

## P1-H4: é‚®ç®±æ ¼å¼éªŒè¯

**é—®é¢˜**: æ— é‚®ç®±æ ¼å¼éªŒè¯ï¼Œç”¨æˆ·å¯ç”¨ "abc" æ³¨å†Œ

**è§£å†³æ–¹æ¡ˆ**: ä½¿ç”¨ `net/mail.ParseAddress` éªŒè¯

---

## P1-H5: RateLimiter ä¼˜é›…å…³é—­

**é—®é¢˜**: æ¸…ç†åç¨‹æ— æ³•åœæ­¢ï¼Œå­˜åœ¨åç¨‹æ³„æ¼

**è§£å†³æ–¹æ¡ˆ**: æ·»åŠ  `done` channel å’Œ `Stop()` æ–¹æ³•

---

## P1-F-H1: CSS å˜é‡æ•´åˆ

**é—®é¢˜**: CSS å˜é‡åœ¨ `admin.html` ä¸­é‡å¤å®šä¹‰å¤šæ¬¡

**è§£å†³æ–¹æ¡ˆ**: åˆ›å»ºç»Ÿä¸€çš„ `web/css/variables.css` æ–‡ä»¶

---

## P1-F-H3: æœåŠ¡æ£€æµ‹ä¿®å¤

**é—®é¢˜**: ä½¿ç”¨ `mode: 'no-cors'` å¯¼è‡´æ— æ³•æ­£ç¡®æ£€æµ‹æœåŠ¡çŠ¶æ€

**è§£å†³æ–¹æ¡ˆ**: æ”¹ç”¨ HEAD è¯·æ±‚ + `response.ok` æ£€æŸ¥

---

# ç¬¬ä¸‰éƒ¨åˆ†ï¼šP2 ä¸­ä¼˜å…ˆçº§å¾…ä¿®å¤é—®é¢˜

## åç«¯é—®é¢˜ (8ä¸ª)

| ç¼–å· | é—®é¢˜ | æ–‡ä»¶ | æè¿° |
|------|------|------|------|
| P2-B1 | æ—¥å¿—çº§åˆ« | `handler.go` | åº”ä½¿ç”¨ç»“æ„åŒ–æ—¥å¿—è€Œé `log.Printf` |
| P2-B2 | é…ç½®ç®¡ç† | `main.go` | å»ºè®®ä½¿ç”¨ viper ç­‰é…ç½®ç®¡ç†åº“ |
| P2-B3 | æ•°æ®åº“è¿æ¥æ±  | `dbstore.go` | åº”é…ç½®è¿æ¥æ± å‚æ•° |
| P2-B4 | API ç‰ˆæœ¬æ§åˆ¶ | `handler.go` | å»ºè®®æ·»åŠ  `/v1/` å‰ç¼€ |
| P2-B5 | è¯·æ±‚éªŒè¯ | `handler.go` | ä½¿ç”¨ validator åº“ç»Ÿä¸€éªŒè¯ |
| P2-B6 | é”™è¯¯ç è§„èŒƒ | `handler.go` | å»ºè®®å®šä¹‰ç»Ÿä¸€çš„é”™è¯¯ç ä½“ç³» |
| P2-B7 | å¥åº·æ£€æŸ¥å¢å¼º | `handler.go` | `/healthz` åº”æ£€æŸ¥æ•°æ®åº“è¿æ¥ |
| P2-B8 | ä¼˜é›…å…³é—­ | `main.go` | åº”å¤„ç† SIGTERM ä¿¡å·ä¼˜é›…å…³é—­ |

## å‰ç«¯é—®é¢˜ (5ä¸ª)

| ç¼–å· | é—®é¢˜ | æ–‡ä»¶ | æè¿° |
|------|------|------|------|
| P2-F1 | è¡¨å•éªŒè¯ | `login.html` | åº”æ·»åŠ å‰ç«¯è¡¨å•éªŒè¯ |
| P2-F2 | åŠ è½½çŠ¶æ€ | å¤šä¸ªæ–‡ä»¶ | åº”æ˜¾ç¤ºåŠ è½½ä¸­çŠ¶æ€ |
| P2-F3 | é”™è¯¯å¤„ç† | å¤šä¸ªæ–‡ä»¶ | åº”ç»Ÿä¸€é”™è¯¯æç¤ºæ ·å¼ |
| P2-F4 | å“åº”å¼è®¾è®¡ | å¤šä¸ªæ–‡ä»¶ | éƒ¨åˆ†é¡µé¢ç§»åŠ¨ç«¯é€‚é…ä¸ä½³ |
| P2-F5 | å›½é™…åŒ–å‡†å¤‡ | å¤šä¸ªæ–‡ä»¶ | ç¡¬ç¼–ç ä¸­æ–‡ï¼Œåº”æå–ä¸ºé…ç½® |

## æ–‡æ¡£é—®é¢˜ (2ä¸ª)

| ç¼–å· | é—®é¢˜ | æ–‡ä»¶ | æè¿° |
|------|------|------|------|
| P2-D1 | API æ–‡æ¡£ | `API.md` | éƒ¨åˆ†æ¥å£ç¼ºå°‘è¯·æ±‚/å“åº”ç¤ºä¾‹ |
| P2-D2 | éƒ¨ç½²æ–‡æ¡£ | ç¼ºå¤± | ç¼ºå°‘ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æŒ‡å— |

---

# ç¬¬å››éƒ¨åˆ†ï¼šP3 ä½ä¼˜å…ˆçº§å¾…ä¿®å¤é—®é¢˜

## åç«¯é—®é¢˜ (4ä¸ª)

| ç¼–å· | é—®é¢˜ | æè¿° |
|------|------|------|
| P3-B1 | ä»£ç æ³¨é‡Š | éƒ¨åˆ†å¤æ‚é€»è¾‘ç¼ºå°‘æ³¨é‡Š |
| P3-B2 | å•å…ƒæµ‹è¯• | æµ‹è¯•è¦†ç›–ç‡è¾ƒä½ |
| P3-B3 | æ€§èƒ½ä¼˜åŒ– | TODO åˆ—è¡¨æ— åˆ†é¡µ |
| P3-B4 | ä»£ç é‡å¤ | éƒ¨åˆ†é”™è¯¯å¤„ç†ä»£ç å¯æå– |

## å‰ç«¯é—®é¢˜ (4ä¸ª)

| ç¼–å· | é—®é¢˜ | æè¿° |
|------|------|------|
| P3-F1 | ä»£ç é£æ ¼ | JavaScript é£æ ¼ä¸ç»Ÿä¸€ |
| P3-F2 | æµè§ˆå™¨å…¼å®¹ | æœªæµ‹è¯•æ—§ç‰ˆæµè§ˆå™¨ |
| P3-F3 | æ€§èƒ½ä¼˜åŒ– | å¤§åˆ—è¡¨æ— è™šæ‹Ÿæ»šåŠ¨ |
| P3-F4 | æ— éšœç¢è®¿é—® | ç¼ºå°‘ ARIA æ ‡ç­¾ |

## æ–‡æ¡£é—®é¢˜ (3ä¸ª)

| ç¼–å· | é—®é¢˜ | æè¿° |
|------|------|------|
| P3-D1 | è´¡çŒ®æŒ‡å— | ç¼ºå°‘ CONTRIBUTING.md |
| P3-D2 | å˜æ›´æ—¥å¿— | CHANGELOG æ ¼å¼å¯ä¼˜åŒ– |
| P3-D3 | æ¶æ„å›¾ | ç¼ºå°‘å¯è§†åŒ–æ¶æ„å›¾ |

---

# éªŒè¯å‘½ä»¤

```bash
# æ„å»ºæµ‹è¯•
cd /Users/xrj/GoProject/Learn4Go-1
go build ./cmd/todoapi

# å¯†ç éªŒè¯æµ‹è¯•
curl -X POST http://localhost:8080/register \
  -H "Content-Type: application/json" \
  -d '{"email":"test@example.com","password":"123"}'
# åº”è¿”å›: {"error":"password must be at least 8 characters with letters and numbers"}

# é‚®ç®±éªŒè¯æµ‹è¯•
curl -X POST http://localhost:8080/register \
  -H "Content-Type: application/json" \
  -d '{"email":"invalid","password":"Test1234"}'
# åº”è¿”å›: {"error":"invalid email format"}
```

---

# ä¿®æ”¹æ–‡ä»¶æ¸…å•

## P0 ä¿®å¤æ¶‰åŠæ–‡ä»¶ (5ä¸ª)
- `cmd/todoapi/main.go`
- `internal/todo/handler.go`
- `internal/todo/store.go`
- `web/login.html`
- `web/admin.html`
- `web/js/mock-api.js`

## P1 ä¿®å¤æ¶‰åŠæ–‡ä»¶ (6ä¸ª)
- `internal/todo/handler.go`
- `internal/todo/security.go`
- `internal/todo/ratelimit.go`
- `web/css/variables.css` (æ–°å»º)
- `web/admin.html`
- `web/portal.html`
