# 前端与 Go 后端映射说明

## 静态资源
- 目录：`web/`
- mock 开关：URL `?mock=true` 或 `localStorage.setItem('mockApi','true')`

## 已对接的 Go 服务
- TODO API：`cmd/todoapi`，端口 `8080`
  - 基础路径：`/v1`
  - `GET /v1/todos` 列表
  - `POST /v1/todos` 创建
  - `PUT /v1/todos/{id}` 更新完成状态
  - `DELETE /v1/todos/{id}` 删除
- 配置：`web/config.js` 中 `todoApiBaseUrl`

## 预留（待实现）
- 网关/认证/日志服务：保持与 Python 仓库路径一致
  - `apiBaseUrl`（未来 gateway）
  - `logApiBaseUrl`（审计/日志服务）
- 前端页面：`web/login.html`、`web/admin.html`、`web/log-detective.html`，将逐步替换为 Go 后端地址。

## Mock 数据
- 文件：`web/mock-data.js`
- 已新增 `/todos` 相关 mock 以便页面在无后端时可用。

---

## 终极对照表：页面-文档-API-脚本关联

> 用这张表可以快速对照“看到的页面 ↔ 应查哪份文档 ↔ 实际打到哪个 API ↔ 用哪个脚本验证”。

### 1. 页面 → 文档 → API

| 页面文件 | 主要用途 | 推荐文档章节 | 关键 API 路径（直连） |
|----------|----------|--------------|------------------------|
| `portal.html` | 学习门户，展示服务状态与入口 | `docs/前端使用指南.md`、“使用场景 / 场景一、二” + `docs/前后端链路与测试指南.md`、“本地直连 TODO API 链路” | `GET /healthz`、`GET /v1/todos`（通过 `todoApiBaseUrl`） |
| `index.html` | 学习导航主页（主要是静态内容） | `docs/前端使用指南.md`、“页面结构与导航” | 无强依赖 API（只依赖静态资源） |
| `projects.html` | 实战项目列表与说明 | `docs/项目文件说明.md`、`docs/快速开始.md` | 无强依赖 API（说明性页面） |
| `todo-login.html` | TODO API 登录 + Refresh + 列表演示 | `docs/前后端链路与测试指南.md`、“2.1 TODO 登录 + 列表” + `docs/JWT认证系统.md` | `POST /v1/login`、`POST /v1/refresh`、`GET /v1/todos` |
| `login.html` | 管理后台登录入口（统一走 Go TODO/RBAC） | `docs/前后端链路与测试指南.md`、“2.2 管理后台登录与用户信息” + `docs/JWT认证系统.md` | `POST /v1/login`、`GET /v1/me` |
| `admin.html` | 管理后台：用户 / 角色 / 权限管理 | `docs/RBAC权限控制.md` + `docs/前后端链路与测试指南.md`、“2.2 管理后台登录与用户信息” | `GET /v1/me`、`GET/POST /v1/users`、`GET /v1/rbac/roles`、`GET /v1/rbac/permissions`、`POST /v1/logout` |
| `log-detective.html` | 日志分析演示（当前更多偏教学示例） | `docs/性能分析pprof.md`、`docs/故障排查.md`（概念性参考） | 后续可对接 `logApiBaseUrl`，目前主要演示前端交互 |

> 说明：以上路径均是“直连 TODO/RBAC 服务”的形式，通过 `web/config.js` 中的 `todoApiBaseUrl` / `apiBaseUrl` 组装最终 URL。

### 2. API → 网关 → Docker 外部入口

| 场景 | 直连地址（本地开发） | 通过网关（本地） | Docker 外部访问 |
|------|----------------------|------------------|-----------------|
| TODO 列表 | `http://localhost:8080/v1/todos` | `http://localhost:8888/api/v1/todos` | `http://localhost/api/v1/todos` |
| 登录 | `http://localhost:8080/v1/login` | （可按需在网关上新增 `/api/v1/login` 映射） | 视 Nginx/Gateway 配置而定 |
| 健康检查 | `http://localhost:8080/healthz` | `http://localhost:8888/health` | `http://localhost/health`（由 Nginx 转发） |

配置来源：

- `web/config.js`：决定前端在本地 / Docker 下实际拼出的 URL 基址；
- `examples/gateway/*`：决定 `/api/v1/*` 前缀如何映射到后端 `/v1/*`；
- `deployments/nginx.conf`：决定 Docker 场景下 `/api/*` 如何代理到网关。

### 3. 脚本 → 链路验证点

| 脚本 | 验证链路 | 涉及的主要 API | 对应文档 |
|------|----------|----------------|----------|
| `scripts/dev-start.sh` | 启动本地直连环境（TODO + Gateway + Frontend） | `GET /healthz`、`GET /v1/todos`（通过 portal.html 状态卡片间接验证） | `docs/本地开发指南.md`、“方式一：一键启动” |
| `scripts/test-smoke.sh` | 直连 + 网关 TODO 冒烟测试 | `POST /v1/login`、`GET /v1/todos`、`GET /api/v1/todos` | `docs/前后端链路与测试指南.md`、“冒烟测试脚本（test-smoke.sh）” |
| `scripts/test-admin.sh` | 管理后台 API 集成测试 | `/v1/login`、`/v1/me`、`/v1/users`、`/v1/rbac/roles`、`/v1/rbac/permissions`、`/v1/logout` | `docs/RBAC权限控制.md` + `docs/前后端链路与测试指南.md`、“管理后台链路” |
| `scripts/deploy-up.sh` | Docker + Nginx + Gateway 部署链路 | `GET /healthz`、`GET /api/v1/todos`（最终从 `http://localhost/api/v1/todos` 访问） | `docs/生产部署指南.md`、“Docker Compose 部署” |

你可以按以下顺序使用这张表自检：

1. 先看“页面 → 文档 → API”确认自己当前调试的页面应该走哪些接口；
2. 再看“API → 网关 → Docker 外部入口”确认在不同环境下应该访问哪个 URL；
3. 最后用“脚本 → 链路验证点”对应的脚本做一遍自动化冒烟，确认链路畅通。 
